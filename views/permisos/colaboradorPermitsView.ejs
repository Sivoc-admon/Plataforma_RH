<%- include('../navbar.ejs') %>

    <script src="/js/permisos/colaboradorPermitsView.js" defer></script>

    <link rel="stylesheet" href="/css/permisos.css">

    <div class="inside-content-css">
        <h1> Módulo Permisos </h1>

        <!-- Main buttons -->
        <div class="columns" style="margin-top: 1rem;">
            <div class="column is-centered" style="text-align: center;">
                <button class="default-button-css functionality-button-css" onclick="createPermitRequest('Permiso')">
                    <i class="fa-solid fa-clipboard-user default-icon-button-css"></i>
                    <p>Registrar permiso</p>
                </button>
            </div>
        
            <div class="column is-centered" style="text-align: center;">
                <button class="default-button-css functionality-button-css" onclick="createPermitRequest('Incapacidad')">
                    <i class="fa-solid fa-wheelchair default-icon-button-css"></i>
                    <p>Registrar incapacidad</p>
                </button>
            </div>

            <div class="column">
                <label class="input">
                    <%= userName + " - " + userArea %>
                </label>
            </div>
        </div>

        <div class="field">
            <div class="control">
                <input class="input" type="text" id="searchInput" placeholder="Buscar por nombre, apellido o área" onkeyup="filterTable()">
            </div>
        </div>

        <table class="table is-fullwidth is-hoverable">
            <thead>
                <tr style="background: linear-gradient(135deg, var(--dark-green), var(--light-blue));">
                    <th class="has-text-centered">Registro</th>
                    <th class="has-text-centered">Filtro</th>
                    <th class="has-text-centered">Fecha inicio</th>
                    <th class="has-text-centered">Fecha termino</th>
                    <th class="has-text-centered">Consultar docs</th>
                    <th class="has-text-centered">Estatus</th>
                    <th class="has-text-centered">Acciones</th>
                </tr>
            </thead>

            <% if (permitsRows.length !== 0) { %>
                <tbody id="tableBody"> 
                    <% permitsRows.forEach(permit=> { %>
                        <tr>
                            <td class="is-centered">
                                <%= permit.registro %>
                            </td>
                            <td class="is-centered">
                                <%= permit.filtro %>
                            </td>
                            <td class="is-centered">
                                <%= permit.fechaInicio %>
                            </td>
                            <td class="is-centered">
                                <%= permit.fechaTermino %>
                            </td>
                            <td class="is-centered">
                                <% if (!permit.docPaths || permit.docPaths.length === 0) { %>
                                    No hay documentos
                                <% } else { %>
                                    <% permit.docPaths.forEach(doc => { %>
                                        <div class="columns is-centered">
                                            <div class="column">
                                                <button class="default-button-css table-button-css" permitId="<%= permit._id %>" filename="<%= doc.originalname %>" onclick="viewPermitsRowFile(this)" >
                                                    <i class="fa-solid fa-eye"></i>
                                                </button>
                                            </div>
                                            <div style="align-self: center; justify-self: center;">
                                                <%= doc.originalname %>
                                            </div>
                                        </div>
                                    <% }) %>
                                <% } %>
                            </td>

                            <td class="is-centered">
                                <% if (!permit.isSent) { %>
                                    <i class="fa-solid fa-triangle-exclamation status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Sin enviar
                                <% } else if (permit.estatus === "Pendiente" || !permit.isVerified) { %>
                                        <i class="fa-solid fa-clock status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Pendiente
                                <% } else if (permit.estatus === "Aprobado") { %>
                                    <i class="fa-solid fa-thumbs-up status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Aprobado
                                <% } else if (permit.estatus === "Cancelado") { %>
                                    <i class="fa-solid fa-thumbs-down status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Cancelado
                                <% } else if (permit.estatus === "Justificado") { %>
                                    <i class="fa-solid fa-thumbs-up status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Justificado
                                <% } else if (permit.estatus === "Injustificado") { %>
                                    <i class="fa-solid fa-thumbs-down status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Injustificado
                                <% } else { %>
                                    <%= permit.estatus %>
                                <% } %>
                            </td>

                            <td class="is-centered">
                                <% if (!permit.isSent) { %>
                                        <div class="columns is-centered">
                                            <div class="column">
                                                <button class="default-button-css table-button-css" permitId="<%= permit._id %>" onclick="editPermit(this)">
                                                    <i class="fa-solid fa-pencil"></i>
                                                </button>
                                            </div>

                                            <div class="column">
                                                <button class="default-button-css table-button-css" permitId="<%= permit._id %>" onclick="deletePermit(this)">
                                                    <i class="fa-solid fa-trash-can"></i>
                                                </button>
                                            </div>

                                            <div class="column">
                                                <button class="default-button-css table-button-css" permitId="<%= permit._id %>" onclick="sendPermit(this)">
                                                    <i class="fa-solid fa-check" style="font-size: 1.552rem;"></i>
                                                </button>
                                            </div>
                                        </div>
                                <% } else if (permit.isSent) { %>
                                    <% if (!permit.isVerified) { %>
                                        <i class="fa-solid fa-check status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Enviado 
                                    <% } else { %>
                                        <i class="fa-solid fa-check status-css" style="justify-self: center; margin-right: 0.5rem;"></i> Recibido
                                    <% } %>
                                <% } else { %>
                                    <%= permit.sent %>
                                <% } %>
                            </td>

                        </tr>
                    <% }); %>
            </tbody>
        </table>
        <% } else { %>
            <h2 style="font-size:2.61rem; display: block; padding: 0.6rem; margin-bottom:1.5rem;">No existen permisos a la fecha.</h2>
        <% }; %>
        <div class="pagination" >
            <button class="default-button-css" onclick="prevPage()">Anterior</button>
            <button class="default-button-css" onclick="nextPage()">Siguiente</button>
        </div>


    </div>